#!/bin/sh

restart_hyprland()
{
  if command -v hyprctl >/dev/null && test -n "$HYPRLAND_INSTANCE_SIGNATURE"; then
    echo "hyprland active, restarting..."
    hyprctl reload
  else
    echo "no hyprland active, skipping restart..."
  fi
  }

case "$1" in
  os)
    echo "rebuilding nix..."
    sudo nixos-rebuild switch --flake .
    echo "installing yazi plugins..."
    ya pkg install
    echo "updating fish shell plugins..."
    fish -c "fisher update"
    restart_hyprland
    echo "done!"
    ;;
  dotfiles)
    echo "running dotbot..."
    dotbot -c install.conf.yaml
    custom_src=$(realpath "./hosts/$(hostname)/custom.conf")
    custom_dest=~/.config/hypr/custom.conf
    if [ -f "$custom_src" ]; then
      echo "hypr custom.conf exists, symlinking it..."
      ln -sf "$custom_src" "$custom_dest"
     elif [ ! -f "$custom_dest" ]; then
      echo "no custom.conf, creating blank file..."
      touch "$custom_dest"
    fi
    restart_hyprland
    echo "done!"
    ;;
  clean)
    nix-collect-garbage -d
    ;;
  toc)
    doctoc README.md
    ;;
  *)
    echo "Usage: $0 {os|dotfiles|clean|toc}"
    ;;
esac

